# Introducción {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

## Objetivo {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

Explicar los conceptos detrás de D3.\
Una librería Javascript para \
representación visual de datos

Base: Javascript, SVG

Cómo se integra con nuestra pila:\
Mithril, Webpack...

## Librería Modular {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}


Puedes escoger lo que cargas

Se puede ampliar vía plugins

- `d3.selection`: buscar y alterar DOM
- `d3.array`: manipular los datos a visualizar
- `d3.scale`: mapeo datos-representación
- `d3.axis`: dibujar ejes
- `d3.transition`: cambios animados
- ...

# Selections {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}


## Selecciones {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

La base de operación de D3.

Muy parecido a JQuery.
Usa selectores XPath/CSS.


`d3.select[All](selector)`: first/all matching elements in the whole document\
`selection.select[All](selector):` first/all matching child elements in selections\

## Modificando selecciones

`append(tag)`, `insert(tag)`, `remove()`, `clone()`

`raise()`, `lower()`, `sort(function)`, `order()`

`attr(name[, value])`\
`style('attrib' [, value])`\
`classed('class1 class2'[, bool])`\
`property('checked'[, value])`\
`text([text])`\
`html([htmlLiteral])`

## Métodos en cascada

Los métodos setters retornan `this`.

Así se pueden llamar a varios en cascada.

```javascript
TODO: Cascading methods example
```

Por convencion cuando alguno canvia de `this`, se desindenta un nivel.
`append`, `insert`, `clone`...


## Joining data




## Control flow

# Scales {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

## Scale {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

Las escalas mapean valores de **dominio de datos**
a **valores de representación** (posición, color, etiquetas...)

```javascript
// Tipos: scaleLinear, scalePow, scaleLog, scaleOrdinal...
var scale = d3.scaleLinear()
    .domain([10, 130])
    .range([0, 960]);
// Ojo: Arrays de dos posiciones, no dos parámetros

// Son callables
scale(20); // 80
scale(50); // 320
scale.invert(80); // 20, de representación a dominio
scale.domain(); // [10, 130], getter/setter
scale.ticks(10); // 10 puntos representativos
// [ 200, 400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000 ]
```

## Ticks {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

Puntos representativos (redondos)

```javascript
scale.ticks(10); // 10 puntos
// [ 200, 400, 600, 800, 1000, 1200, 1400, 1600, 1800, 2000 ]
// Funcion o especificador de formato para los valores de tick
scale.tickFormat(
scale.ticks(10).map(scale.tickFormat())
```

`scale.nice()` extiende los limites del dominio a valores redondos.


## Escalas Numéricas {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

- `Linear`: `x: y = mx + b`
- `Pow`: `x: y = mx^k + b`
	(configurable `exponent`)
- `Log`: `x: y = m log(x) + b`
	(configurable `base`)
- `Identity`: Alias para `Linear` de [0,1] a [0,1]
- `Sqrt`: Alias para `Pow` con `exponent 0.5`

Por defecto, un valor fuera del intervalo/dominio se extrapola.

Si indicamos `scale.clamp()`, se mapea al valor extremo.


## Escalas interpoladas {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

Se usa una funcion en vez de un intervalo de salida

Pensados para usar interpoladores de colores del paquete `d3.scale-chromatic`

`Sequential`: Dominio definido por dos valores, se mapean a 0,1 que se pasa al interpolador\
![](images/d3-sequentialInterpolator-Greens.png){height=20px}

`Diverging`: Dominio definido por tres valores, se mapean a -1, 0, 1, y se pasa al interpolador\
![](images/d3-divergentInterpolator-PuOr.png){height=20px}


## Escalas discretas {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

Dominios continuos a un conjunto limitado de valores

- `Quantize`: Segmentos de igual longitud en el dominio
- `Quantile`: Segmentos con igual numero de elementos del domain
- `Threshold`: Segmentos con umbrales arbitrarios (domain define N umbrales, range N+1 salidas)

`scale.invertExtend(valorSalida)` -> [inicio, fin]

## Dominios Discretos

- `Ordinal`: Discretos a discretos, por orden
- `Point`: Discretos a puntos espaciados en el intervalo
	- Definimos `padding` (outer) como ratio del range
- `Band`: Distribuye y expande elementos discretos en el intervalo
	- Definimos `paddingInner` y `paddingOuter`
	- Devuelve el inicio de cada banda y el `bandwidth` resultante

## Dominio temporal {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}

- `Time`: domain is local time
- `Utc`: domain is utc time



# Axis {
	data-background-image="../images/logo-somenergia-nobg.svg"
	data-background-size="80%"
	}


## Axis

Genera SVG's para los ejes de una gráfica.

Se basa en un scale.

